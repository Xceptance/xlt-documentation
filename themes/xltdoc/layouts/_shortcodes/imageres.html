{{ $src := .Get "src" }}
{{ $original := .Page.Resources.GetMatch (printf "**%s*" ($src)) }}
{{ .Scratch.Set "image" ($original.Resize "600x") }}
{{ $image := .Scratch.Get "image" }}

<div class="imagebox">
<a href="{{ .Get `src` }}" data-lightbox="{{ .Page.Title }}" {{ with .Inner }}data-title="{{ . | markdownify}}"{{ end }}>
	<img  style="{{ if ne (.Get "shadow") "false" }}box-shadow: 1px 1px 5px 1px #ccc{{ end }}" src="{{ $image.RelPermalink }}" width="{{ $image.Width }}" height="{{ $image.Height }}" alt="" />
</a>

{{ with .Inner }}
<p class="image-description">{{ . | markdownify }}</p>
{{ end }}
</div>